
'use strict';var restaurant=void 0;var map;window.initMap=function(){fetchRestaurantFromURL().then(function(restaurant,error){self.map=new google.maps.Map(document.getElementById('map'),{zoom:16,center:restaurant.latlng,scrollwheel:false});fillBreadcrumb();DBHelper.mapMarkerForRestaurant(self.restaurant,self.map);}).catch(function(error){console.log(error);});};fetchRestaurantFromURL=function fetchRestaurantFromURL(callback){return new Promise(function(resolve,reject){if(self.restaurant){resolve(self.restaurant);}
var id=getParameterByName('id');if(!id){error='No restaurant id in URL';reject(error);}else{return DBHelper.fetchRestaurantById(id).then(function(restaurant,error){self.restaurant=restaurant;if(!restaurant){reject(error);}
fillRestaurantHTML();resolve(restaurant);});}});};fillRestaurantHTML=function fillRestaurantHTML(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var icon=document.getElementById('favorite');icon.addEventListener('click',function(e){var favorite=self.restaurant.is_favorite===true?false:true;self.restaurant.is_favorite=favorite;DBHelper.setFavorite(restaurant.id,favorite);setFavorite(e.path[0],favorite);});var name=document.getElementById('restaurant-name');name.innerHTML=restaurant.name;name.appendChild(icon);setFavorite(icon,restaurant.is_favorite==='true'?true:false);var address=document.getElementById('restaurant-address');address.innerHTML=restaurant.address;var image=document.getElementById('restaurant-img');image.className='restaurant-img';image.alt='Restaurant '+restaurant.name+' (thumbnail)';image.src=DBHelper.imageUrlForRestaurant(restaurant);var cuisine=document.getElementById('restaurant-cuisine');cuisine.innerHTML=restaurant.cuisine_type;if(restaurant.operating_hours){fillRestaurantHoursHTML();}
fillReviewsHTML();};setFavorite=function setFavorite(icon,isFavorite){if(isFavorite){icon.innerHTML='favorite';}else{icon.innerHTML='favorite_border';}};fillRestaurantHoursHTML=function fillRestaurantHoursHTML(){var operatingHours=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant.operating_hours;var hours=document.getElementById('restaurant-hours');for(var key in operatingHours){var row=document.createElement('tr');var day=document.createElement('td');day.innerHTML=key;row.appendChild(day);var time=document.createElement('td');time.innerHTML=operatingHours[key];row.appendChild(time);hours.appendChild(row);}};addReview=function addReview(){var name=document.getElementById('name').value;var rating=document.getElementById('rating').value;var comment=document.getElementById('comment').value;var idRestaurant=self.restaurant.id;DBHelper.addReview(idRestaurant,name,rating,comment).then(function(review){var ul=document.getElementById('reviews-list');ul.prepend(createReviewHTML(review));});};fillReviewsHTML=function fillReviewsHTML(){var reviews=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.reviews;var container=document.getElementById('reviews-container');var button=document.getElementById('add-review-button');var rating=document.getElementById('rating');for(var i=1;i<=5;i++){var option=document.createElement('option');option.value=i;option.innerHTML=i;rating.appendChild(option);}
if(!reviews.length){var noReviews=document.createElement('p');noReviews.innerHTML='No reviews yet!';container.appendChild(noReviews);return;}
var ul=document.getElementById('reviews-list');reviews.forEach(function(review){ul.appendChild(createReviewHTML(review));});container.appendChild(ul);};createReviewHTML=function createReviewHTML(review){var top=document.createElement('div');top.setAttribute('class','top');var li=document.createElement('li');var name=document.createElement('p');name.innerHTML=review.name;var date=document.createElement('p');date.setAttribute('class','date');var newDate=new Date(review.updatedAt!==undefined?review.updatedAt:review.id);date.innerHTML=newDate.getDay()+'/'+newDate.getMonth()+'/'+newDate.getFullYear();top.appendChild(name);top.appendChild(date);li.appendChild(top);var rating=document.createElement('p');rating.setAttribute('class','rating');rating.innerHTML='Rating: '+review.rating;li.appendChild(rating);var comments=document.createElement('p');comments.setAttribute('class','comments');comments.innerHTML=review.comments;li.appendChild(comments);return li;};fillBreadcrumb=function fillBreadcrumb(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var breadcrumb=document.getElementById('breadcrumb');var li=document.createElement('li');li.innerHTML=restaurant.name;breadcrumb.appendChild(li);};getParameterByName=function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,'\\$&');var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)'),results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g,' '));};